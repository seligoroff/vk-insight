# Настройка

## Получение токена VK API

Для работы инструмента необходим **ключ доступа пользователя** (User Access Token) с соответствующими правами.

### Шаг 1: Создание приложения

1. Перейдите на [VK Developers](https://vk.com/dev)
2. Войдите в свой аккаунт VK
3. Перейдите в раздел **"Мои приложения"** → **"Создать приложение"**
4. Выберите тип приложения: **"Standalone"** (самостоятельное приложение)
5. Заполните название приложения
6. После создания вы получите **Application ID** (Client ID) - запомните его

### Шаг 2: Настройка приложения

1. В настройках приложения перейдите в раздел **"Настройки"**
2. В поле **"Адрес сайта"** укажите любой валидный URL (например, `https://example.com`)
3. В поле **"Базовый домен"** укажите домен (например, `example.com`)
4. Сохраните изменения

### Шаг 3: Получение токена доступа

Есть два способа получить токен:

#### Способ 1: Через команду (рекомендуется) ✅

Используйте интерактивные команды для получения токенов:

**Для user access token:**
```bash
php artisan vk:token-get-user
```

**Для community access token:**
```bash
php artisan vk:token-get-group
```

Команды автоматически обработают OAuth 2.0 flow и выдадут готовый токен для добавления в `.env`.

#### Способ 2: Вручную через браузер

Используйте специальную ссылку для получения токена. Замените `YOUR_APP_ID` на ваш Application ID:

```
https://oauth.vk.com/authorize?client_id=YOUR_APP_ID&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=wall,groups,photos,audio,offline&response_type=token&v=5.122
```

**Как использовать:**
1. Скопируйте ссылку выше и замените `YOUR_APP_ID` на ваш Application ID
2. Вставьте ссылку в браузер и нажмите Enter
3. Разрешите доступ приложению
4. После редиректа вы увидите URL вида:
   ```
   https://oauth.vk.com/blank.html#access_token=TOKEN_HERE&expires_in=0&user_id=12345678
   ```
5. Скопируйте значение параметра `access_token` из URL - это ваш токен

**Права доступа (scope) в ссылке:**
- `wall` - доступ к стенам (чтение постов) - **обязательно**
- `groups` - доступ к группам - **обязательно**
- `photos` - доступ к фотографиям (для команд работы с альбомами)
- `audio` - доступ к аудиозаписям (для команд работы с аудио)
- `offline` - бессрочный токен (рекомендуется, токен не истечет)

**Пример полной ссылки:**
Если ваш Application ID = `12345678`, то ссылка будет:
```
https://oauth.vk.com/authorize?client_id=12345678&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=wall,groups,photos,audio,offline&response_type=token&v=5.122
```

### Шаг 4: Проверка токена

После получения токена проверьте его с помощью команды:

```bash
php artisan vk:token-check --token=ваш_токен
```

Команда покажет:
- ✅ Валидность токена
- ✅ Информацию о пользователе
- ✅ Права доступа, которыми обладает токен

### Альтернативный способ (для быстрого тестирования)

Если нужно быстро получить токен для тестирования, можно использовать неофициальный сервис:
1. Перейдите на [VK API Test Tool](https://vkhost.github.io/)
2. Выберите необходимые права доступа
3. Нажмите "Получить токен"
4. Скопируйте полученный токен

⚠️ **Внимание:** Используйте Test Tool только для тестирования. Для постоянного использования создайте собственное приложение через VK Developers.

## Настройка переменных окружения

Создайте файл `.env` и настройте следующие параметры:

```env
VK_TOKEN=ваш_токен_vk_api
VK_API_VERSION=5.122
VK_VERIFY_SSL=false
VK_ACCOUNT_BASE_URL=https://vk.com
VK_ANALYTICS_TIMEZONE=Europe/Moscow
```

### Параметры VK API

- `VK_TOKEN` - токен доступа VK API (обязательный)
- `VK_API_VERSION` - версия API (по умолчанию: 5.122)
- `VK_VERIFY_SSL` - проверка SSL сертификатов (по умолчанию: false)
- `VK_ACCOUNT_BASE_URL` - базовый URL аккаунта для генерации ссылок (по умолчанию: https://vk.com)
- `VK_ANALYTICS_TIMEZONE` - таймзона для аналитики (по умолчанию: используется `APP_TIMEZONE` или UTC)

**Примечание:** `VK_ANALYTICS_TIMEZONE` используется командой `vk:analytics` для группировки постов по часам и дням недели. Для российских групп рекомендуется указать `Europe/Moscow`. Если не указано, используется таймзона из `APP_TIMEZONE` или UTC.

## Подготовка списка групп

Для команд, работающих со списком групп, создайте файл `resources/vk-groups.csv` со списком URL групп:

```csv
https://vk.com/groupname1
https://vk.com/groupname2
https://vk.com/anothergroup
```

Каждая строка должна содержать полный URL группы VK.

Файл можно создать автоматически:
```bash
make vk-groups-file
```

## Как узнать ID группы или пользователя

### ID группы:
1. Откройте группу в VK
2. Посмотрите на URL: `https://vk.com/club12345678` или `https://vk.com/groupname`
3. Если видите `club` или число в URL - это ID группы
4. Для использования в командах добавьте минус: `-12345678`

### ID пользователя:
1. Откройте профиль пользователя
2. В URL будет `https://vk.com/id12345678` или `https://vk.com/username`
3. Число после `id` - это ID пользователя

### Резолв короткого имени:
Можно использовать короткое имя группы (screen name) вместо ID. Инструмент автоматически резолвит его в ID.

## Структура файлов

```
resources/
└── vk-groups.csv          # Список групп (создается вручную)

database/
└── database.sqlite        # SQLite база данных (создается автоматически)
                           # Содержит таблицы: vk_posts, vk_check_cache
                           # vk_posts - хранит посты для аналитики и поиска
                           # vk_check_cache - кеш результатов команды vk:check
                           #   (включает: post_text, post_date, likes, reposts, members_count, time_since_post)
```


